<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMJ ERP | New Bill</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/print.css" media="print">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo">SMJ</div>
                <div class="brand-info">
                    <h1>New Bill - Shree Mahakaleshwar Jewellers</h1>
                    <p class="tagline">Wear With Cheer</p>
                </div>
            </div>
            <div class="user-info">
                <button class="btn-secondary" onclick="window.location.href='index.html'">
                    <i class="fas fa-arrow-left"></i> Dashboard
                </button>
                <button class="btn-logout" onclick="auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="sidebar">
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="billing.html" class="nav-link">
                        <i class="fas fa-file-invoice"></i> New Bill
                    </a>
                </li>
                <li class="nav-item">
                    <a href="exchange.html" class="nav-link">
                        <i class="fas fa-exchange-alt"></i> Exchange
                    </a>
                </li>
                <li class="nav-item">
                    <a href="stocks.html" class="nav-link">
                        <i class="fas fa-boxes"></i> Stock
                    </a>
                </li>
                <li class="nav-item">
                    <a href="reports.html" class="nav-link">
                        <i class="fas fa-chart-bar"></i> Reports
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="billing-container">
                <!-- Customer Details Section -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-user"></i> Customer Details</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerName" class="required">Customer Name</label>
                                <input type="text" id="customerName" placeholder="Enter customer name" required>
                            </div>
                            <div class="form-group">
                                <label for="customerPhone" class="required">Phone Number</label>
                                <input type="tel" id="customerPhone" placeholder="10-digit phone number" pattern="[0-9]{10}" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerAddress">Address</label>
                                <textarea id="customerAddress" rows="2" placeholder="Enter customer address"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Item Form -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-gem"></i> Product Details</h3>
                        <div class="exchange-warning" id="exchangeWarning" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Exchange items have 3% automatic deduction applied</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Row 1 -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName" class="required">Product Name</label>
                                <input type="text" id="productName" placeholder="e.g., Gold Ring, Diamond Necklace" required>
                            </div>
                            <div class="form-group">
                                <label for="unit" class="required">Unit</label>
                                <select id="unit" required>
                                    <option value="">Select Unit</option>
                                    <option value="PCS">PCS (Pieces)</option>
                                    <option value="GM">GM (Grams)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="quantity" class="required">Quantity</label>
                                <input type="number" id="quantity" min="1" step="1" value="1" required>
                            </div>
                        </div>

                        <!-- Row 2 - Weight Details -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="grossWeight" class="required">Gross Weight (g)</label>
                                <input type="number" id="grossWeight" min="0" step="0.001" placeholder="0.000" required>
                            </div>
                            <div class="form-group">
                                <label for="lessWeight">Less Weight (g)</label>
                                <input type="number" id="lessWeight" min="0" step="0.001" placeholder="0.000">
                            </div>
                            <div class="form-group">
                                <label for="netWeight">Net Weight (g)</label>
                                <input type="number" id="netWeight" readonly>
                            </div>
                        </div>

                        <!-- Row 3 - Metal Details -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="metalType" class="required">Metal Type</label>
                                <select id="metalType" required>
                                    <option value="">Select Metal</option>
                                    <!-- Dynamically populated -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="purity" class="required">Purity</label>
                                <select id="purity" required disabled>
                                    <option value="">Select Purity</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="rate" class="required">Rate (₹/g)</label>
                                <input type="number" id="rate" min="0" step="0.01" required readonly>
                            </div>
                        </div>

                        <!-- Row 4 - Making Charges -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="makingChargeType" class="required">Making Charge Type</label>
                                <select id="makingChargeType" required>
                                    <option value="FIX">FIX (₹)</option>
                                    <option value="%" selected>% (Percentage)</option>
                                    <option value="GRM">GRM (₹ per gram)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="makingChargeValue" class="required">Making Charge Value</label>
                                <input type="number" id="makingChargeValue" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="discountOnMaking">Discount on Making (₹)</label>
                                <input type="number" id="discountOnMaking" min="0" step="0.01" value="0">
                            </div>
                        </div>

                        <!-- Row 5 - Additional Details -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="huid">HUID</label>
                                <input type="text" id="huid" placeholder="Hallmark Unique ID">
                            </div>
                            <div class="form-group">
                                <label for="tunch">Tunch</label>
                                <input type="text" id="tunch" placeholder="e.g., 916">
                            </div>
                            <div class="form-group">
                                <label for="otherCharges">Other Charges (₹)</label>
                                <input type="number" id="otherCharges" min="0" step="0.01" value="0">
                            </div>
                        </div>

                        <!-- Row 6 - Image Upload -->
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="productImage">Product Image</label>
                                <div class="image-upload-container" onclick="document.getElementById('imageFile').click()">
                                    <i class="fas fa-camera fa-2x"></i>
                                    <p>Click to upload product image</p>
                                    <p class="small">or drag and drop</p>
                                    <input type="file" id="imageFile" accept="image/*" style="display: none;">
                                </div>
                                <div id="imagePreviewContainer" style="display: none; margin-top: 1rem;">
                                    <img id="imagePreview" style="max-width: 200px; max-height: 200px;">
                                </div>
                            </div>
                        </div>

                        <!-- Row 7 - Exchange & Notes -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="isExchange">
                                    <span>This is an exchange item</span>
                                </label>
                                <small class="text-muted">Note: 3% automatic deduction applies</small>
                            </div>
                            <div class="form-group full-width">
                                <label for="notes">Notes / Description</label>
                                <textarea id="notes" rows="2" placeholder="Additional details about the product"></textarea>
                            </div>
                        </div>

                        <!-- Item Calculation Display -->
                        <div class="calculation-summary">
                            <div class="calc-item">
                                <span>Metal Value:</span>
                                <span id="metalValueDisplay">₹0.00</span>
                            </div>
                            <div class="calc-item">
                                <span>Making Charge:</span>
                                <span id="makingChargeDisplay">₹0.00</span>
                            </div>
                            <div class="calc-item">
                                <span>Other Charges:</span>
                                <span id="otherChargesDisplay">₹0.00</span>
                            </div>
                            <div class="calc-item exchange-deduction" style="display: none;">
                                <span>Exchange Deduction (-3%):</span>
                                <span id="exchangeDeductionDisplay" class="text-danger">-₹0.00</span>
                            </div>
                            <div class="calc-item total">
                                <span>Item Total:</span>
                                <span id="itemTotalDisplay">₹0.00</span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="form-actions">
                            <button class="btn-secondary" id="clearItemBtn">
                                <i class="fas fa-times"></i> Clear
                            </button>
                            <button class="btn-primary" id="addItemBtn">
                                <i class="fas fa-plus"></i> Add to Bill
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bill Items Table -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-list"></i> Bill Items</h3>
                        <span class="badge" id="itemCount">0 items</span>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="data-table" id="itemsTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Product</th>
                                        <th>Metal/Purity</th>
                                        <th>Weight</th>
                                        <th>Rate</th>
                                        <th>Metal Value</th>
                                        <th>Making</th>
                                        <th>Other</th>
                                        <th>Total</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="itemsTableBody">
                                    <!-- Items will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- GST Section -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-receipt"></i> GST Details</h3>
                        <div class="gst-warning" id="gstWarning" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <span>GST not applicable for this metal type</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cgst">CGST (₹)</label>
                                <input type="number" id="cgst" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="sgst">SGST (₹)</label>
                                <input type="number" id="sgst" min="0" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label for="igst">IGST (₹)</label>
                                <input type="number" id="igst" min="0" step="0.01" value="0">
                            </div>
                        </div>
                        <div class="gst-info">
                            <p><strong>Note:</strong> GST amounts are manually entered. Total GST will be calculated automatically.</p>
                            <p>Total GST: <span id="totalGSTDisplay">₹0.00</span></p>
                        </div>
                    </div>
                </div>

                <!-- Payment & Summary -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-calculator"></i> Bill Summary & Payment</h3>
                    </div>
                    <div class="card-body">
                        <div class="summary-container">
                            <div class="payment-details">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="paymentMethod" class="required">Payment Method</label>
                                        <select id="paymentMethod" required>
                                            <option value="cash">Cash</option>
                                            <option value="card">Card</option>
                                            <option value="upi">UPI</option>
                                            <option value="bank_transfer">Bank Transfer</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="paymentStatus" class="required">Payment Status</label>
                                        <select id="paymentStatus" required>
                                            <option value="paid">Paid</option>
                                            <option value="pending">Pending</option>
                                            <option value="partial">Partial</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group full-width">
                                        <label for="billNotes">Bill Notes</label>
                                        <textarea id="billNotes" rows="2" placeholder="Additional notes for the bill"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="bill-summary">
                                <div class="summary-item">
                                    <span>Subtotal:</span>
                                    <span id="subtotalDisplay">₹0.00</span>
                                </div>
                                <div class="summary-item">
                                    <span>CGST:</span>
                                    <span id="cgstDisplay">₹0.00</span>
                                </div>
                                <div class="summary-item">
                                    <span>SGST:</span>
                                    <span id="sgstDisplay">₹0.00</span>
                                </div>
                                <div class="summary-item">
                                    <span>IGST:</span>
                                    <span id="igstDisplay">₹0.00</span>
                                </div>
                                <div class="summary-item total-gst">
                                    <span>Total GST:</span>
                                    <span id="totalGstDisplay">₹0.00</span>
                                </div>
                                <div class="summary-item exchange-summary" style="display: none;">
                                    <span>Exchange Deduction:</span>
                                    <span id="totalExchangeDeduction" class="text-danger">-₹0.00</span>
                                </div>
                                <div class="summary-item grand-total">
                                    <span>Grand Total:</span>
                                    <span id="totalAmountDisplay">₹0.00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Final Actions -->
                        <div class="final-actions">
                            <button class="btn-secondary" id="clearBillBtn">
                                <i class="fas fa-trash"></i> Clear Bill
                            </button>
                            <button class="btn-primary" id="generateBillBtn">
                                <i class="fas fa-file-pdf"></i> Generate Bill & PDF
                            </button>
                            <button class="btn-success" id="saveDraftBtn">
                                <i class="fas fa-save"></i> Save Draft
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Shree Mahakaleshwar Jewellers Billing System | Manual GST Entry | Fixed 3% Exchange Deduction</p>
        </footer>
    </div>

    <!-- Bill Success Modal -->
    <div class="modal" id="billSuccessModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Bill Generated Successfully!</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="success-message">
                    <i class="fas fa-check-circle"></i>
                    <p>Bill has been generated and PDF is ready for download.</p>
                    <p><strong>Bill Number:</strong> <span id="generatedBillNumber"></span></p>
                    <p><strong>Total Amount:</strong> <span id="generatedBillAmount"></span></p>
                </div>
                <div class="qr-section" id="qrSection">
                    <!-- QR codes will be added here -->
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="printBill()">
                        <i class="fas fa-print"></i> Print Bill
                    </button>
                    <button class="btn-primary" onclick="downloadPDF()">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                    <button class="btn-success" onclick="sendWhatsApp()">
                        <i class="fab fa-whatsapp"></i> Send via WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/billing.js"></script>
</body>
</html>
